<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞ / Balance Wheel</title>
  <!-- Bootstrap 5 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      transition: background-color 0.3s, color 0.3s;
    }
    /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }
    body.dark-mode .navbar,
    body.dark-mode .nav-tabs {
      background-color: #1f1f1f;
    }
    body.dark-mode .nav-tabs .nav-link.active {
      background-color: #2c2c2c;
      color: #fff;
    }

    /* –£–ª—É—á—à–∏–º –≤–∏–¥–∏–º–æ—Å—Ç—å –æ–ø–∏—Å–∞–Ω–∏–π –∏ –ª–µ–π–±–ª–æ–≤ –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
    body.dark-mode .form-label,
    body.dark-mode .form-text {
      color: #ccc;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è canvas —Å–æ —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–º–∏ —É–≥–ª–∞–º–∏ */
    .canvas-container {
      border: 1px solid #ccc;
      border-radius: 20px;
      padding: 10px;
      overflow: hidden; /* —á—Ç–æ–±—ã —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ –±—ã–ª–æ –∑–∞–º–µ—Ç–Ω–æ */
      margin-bottom: 1rem;
      background-color: #fff; /* —Å–≤–µ—Ç–ª–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ */
    }
    body.dark-mode .canvas-container {
      background-color: #333;
      border-color: #555;
    }

    /* –°–∞–º canvas —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –ø–æ–±–æ–ª—å—à–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 600x600),
       –∏ –¥–∞—ë–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–º–µ–Ω—å—à–∞—Ç—å—Å—è –ø–æ–¥ –º–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã */
    #balanceWheel {
      display: block;
      max-width: 100%;
      height: auto; /* —á—Ç–æ–±—ã –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å */
      margin: 0 auto;
    }

    /* –ß—Ç–æ–±—ã –≤–∫–ª–∞–¥–∫–∏/–∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑ —Å–ª–æ–≤–∞ "–°—Ä–µ–¥–Ω–µ–µ" —Å–º–æ—Ç—Ä–µ–ª–∏—Å—å –∞–∫–∫—É—Ä–∞—Ç–Ω–µ–µ */
    .sphere-header {
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        ‚öôÔ∏è –ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞ / Balance Wheel
      </a>
      <div class="d-flex">
        <button id="themeToggle" class="btn btn-secondary me-2">
          üåû –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
        </button>
        <button id="langToggle" class="btn btn-secondary">
          üåê EN
        </button>
      </div>
    </div>
  </nav>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="container mt-4">
    <div class="row">
      <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –≤–∫–ª–∞–¥–∫–∏ —Å—Ñ–µ—Ä -->
      <div class="col-md-6">
        <ul class="nav nav-tabs" id="sphereTabs" role="tablist"></ul>
        <div class="tab-content" id="sphereTabContent"></div>
      </div>
      <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –∫–æ–ª–µ—Å–æ –±–∞–ª–∞–Ω—Å–∞ –∏ –æ–±—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ -->
      <div class="col-md-6">
        <h4 id="wheelTitle">–ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞</h4>
        <div class="canvas-container">
          <canvas id="balanceWheel" width="600" height="600"></canvas>
        </div>
        <div id="overallAverage" class="mt-2"></div>
      </div>
    </div>
    <div class="mt-3">
      <button id="saveResults" class="btn btn-primary me-2">
        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (JSON)
      </button>
      <button id="savePDF" class="btn btn-danger">
        üìÑ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (PDF)
      </button>
    </div>
  </div>

  <!-- –°–∫—Ä–∏–ø—Ç—ã: Bootstrap, html2canvas, jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    /************************************************
     * 1. –î–ê–ù–ù–´–ï –í–°–ï–• –°–§–ï–† + –≠–ú–û–î–ó–ò, –ü–û–õ–ó–£–ù–ö–ò –û–¢ 0 –î–û 10
     ************************************************/

    // –ù–∞–±–æ—Ä ¬´–∫—Ä–∞—Å–∏–≤—ã—Ö¬ª –ø–∞—Å—Ç–µ–ª—å–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ –¥–ª—è —Å–µ–∫—Ç–æ—Ä–æ–≤
    const pastelColors = [
      "#FFB3BA", // —Ä–æ–∑–æ–≤–∞—Ç—ã–π
      "#FFDFBA", // –æ—Ä–∞–Ω–∂–µ–≤–æ-–ø–µ—Ä—Å–∏–∫–æ–≤—ã–π
      "#FFFFBA", // –±–ª–µ–¥–Ω–æ-–∂—ë–ª—Ç—ã–π
      "#BAFFC9", // –±–ª–µ–¥–Ω–æ-–∑–µ–ª—ë–Ω—ã–π
      "#BAE1FF", // –≥–æ–ª—É–±–æ–π
      "#D7BAFF", // —Å–∏—Ä–µ–Ω–µ–≤—ã–π
      "#FFBAE8", // —Ä–æ–∑–æ–≤—ã–π
      "#BAFFFA", // –±–∏—Ä—é–∑–æ–≤—ã–π
      // –µ—Å–ª–∏ —Å—Ñ–µ—Ä –±–æ–ª—å—à–µ 8, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ—â—ë
    ];

    // –ü—Ä–∏–º–µ—Ä 8 —Å—Ñ–µ—Ä: –¥–æ–±–∞–≤–∏–º –∫–∞–∂–¥–æ–º—É sphere –µ—â—ë –ø–æ–ª–µ emoji
    const spheres = [
      {
        id: "health",
        emoji: "‚ù§Ô∏è",
        title: { ru: "–ó–¥–æ—Ä–æ–≤—å–µ", en: "Health" },
        questions: [
          {
            id: "appearance",
            title: { ru: "–í–Ω–µ—à–Ω–∏–π –≤–∏–¥", en: "Appearance" },
            descriptions: {
              0: {
                ru: "0 ‚Äì –∂–∏—Ä–Ω—ã–π –∏ –±–æ–ª—è—á–∏–π",
                en: "0 ‚Äì overweight and obviously unhealthy",
              },
              5: {
                ru: "5 ‚Äì —Å—Ä–µ–¥–Ω–∏–π –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥",
                en: "5 ‚Äì average appearance",
              },
              10: {
                ru: "10 ‚Äì —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π, –∏–∑–ª—É—á–∞—é –∑–¥–æ—Ä–æ–≤—å–µ",
                en: "10 ‚Äì athletic, radiating health",
              },
            },
          },
          {
            id: "nutrition",
            title: { ru: "–ü–∏—Ç–∞–Ω–∏–µ", en: "Nutrition" },
            descriptions: {
              0: {
                ru: "0 ‚Äì –∂—Ä—É —á—Ç–æ –ø–æ–ø–∞–ª–æ (–º–∞–∫—à–ª–∞–∫)",
                en: "0 ‚Äì eat junk randomly",
              },
              5: {
                ru: "5 ‚Äì —Å—Ä–µ–¥–Ω—è—è –¥–∏–µ—Ç–∞, –∏–Ω–æ–≥–¥–∞ —Å–ª–µ–∂—É",
                en: "5 ‚Äì average diet, sometimes watch it",
              },
              10: {
                ru: "10 ‚Äì –∑–¥–æ—Ä–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –ø–æ –≥—Ä–∞—Ñ–∏–∫—É",
                en: "10 ‚Äì healthy eating on schedule",
              },
            },
          },
        ],
      },
      {
        id: "relationships",
        emoji: "ü§ù",
        title: { ru: "–û—Ç–Ω–æ—à–µ–Ω–∏—è", en: "Relationships" },
        questions: [
          {
            id: "communication",
            title: { ru: "–û–±—â–µ–Ω–∏–µ", en: "Communication" },
            descriptions: {
              0: {
                ru: "0 ‚Äì –æ–±—â–∞—é—Å—å —Ç–æ–ª—å–∫–æ –ø–æ –æ—Å—Ç—Ä–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏",
                en: "0 ‚Äì only communicate when forced",
              },
              5: {
                ru: "5 ‚Äì —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –æ–±—â–µ–Ω–∏—è",
                en: "5 ‚Äì average communication",
              },
              10: {
                ru: "10 ‚Äì –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–∂—É –æ–±—â–∏–π —è–∑—ã–∫ —Å –∫–µ–º —É–≥–æ–¥–Ω–æ",
                en: "10 ‚Äì masterful communication with anyone",
              },
            },
          },
          {
            id: "friends",
            title: { ru: "–î—Ä—É–∑—å—è", en: "Friends" },
            descriptions: {
              0: {
                ru: "0 ‚Äì –º–µ–Ω—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–ª–∏ –∏—Ö –Ω–µ—Ç",
                en: "0 ‚Äì no real friends or they exploit me",
              },
              5: {
                ru: "5 ‚Äì –ø–∞—Ä–∞-—Ç—Ä–æ–π–∫–∞ –Ω–∞–¥—ë–∂–Ω—ã—Ö –ª—é–¥–µ–π",
                en: "5 ‚Äì a few reliable friends",
              },
              10: {
                ru: "10 ‚Äì –º–Ω–æ–≥–æ –≤–µ—Ä–Ω—ã—Ö –¥—Ä—É–∑–µ–π, –≤—Å–µ–≥–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç",
                en: "10 ‚Äì many loyal friends, always supportive",
              },
            },
          },
        ],
      },
      {
        id: "environment",
        emoji: "üè†",
        title: { ru: "–û–∫—Ä—É–∂–µ–Ω–∏–µ", en: "Environment" },
        questions: [
          {
            id: "relatives",
            title: { ru: "–†–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏", en: "Relatives" },
            descriptions: {
              0: {
                ru: "0 ‚Äì –Ω–µ–Ω–∞–≤–∏–¥–∏–º –¥—Ä—É–≥ –¥—Ä—É–≥–∞",
                en: "0 ‚Äì we hate each other",
              },
              5: {
                ru: "5 ‚Äì —Å—Ä–µ–¥–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –∏–Ω–æ–≥–¥–∞ –æ–±—â–∞–µ–º—Å—è",
                en: "5 ‚Äì average relationship, occasional contact",
              },
              10: {
                ru: "10 ‚Äì –∏–¥–µ–∞–ª—å–Ω—ã–µ, –ø–æ–ª–Ω–æ–µ –≤–∑–∞–∏–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏–µ",
                en: "10 ‚Äì ideal, complete understanding",
              },
            },
          },
        ],
      },
      {
        id: "calling",
        emoji: "üéØ",
        title: { ru: "–ü—Ä–∏–∑–≤–∞–Ω–∏–µ", en: "Calling" },
        questions: [
          {
            id: "efficiency",
            title: { ru: "–ö–ü–î", en: "Efficiency" },
            descriptions: {
              0: {
                ru: "0 ‚Äì –Ω–∏–∫–æ–≥–¥–∞ –Ω–∏—á–µ–≥–æ –Ω–µ —É—Å–ø–µ–≤–∞—é",
                en: "0 ‚Äì never manage to do anything",
              },
              5: {
                ru: "5 ‚Äì –¥–µ–ª–∞—é —á–∞—Å—Ç—å –∑–∞–¥—É–º–∞–Ω–Ω–æ–≥–æ",
                en: "5 ‚Äì do part of my plans",
              },
              10: {
                ru: "10 ‚Äì –∫—Ä–∞–π–Ω–µ –≤—ã—Å–æ–∫–∞, —É—Å–ø–µ–≤–∞—é –≤—Å—ë",
                en: "10 ‚Äì extremely high, do everything",
              },
            },
          },
        ],
      },
      {
        id: "finance",
        emoji: "üí∞",
        title: { ru: "–û–±–µ—Å–ø–µ—á–µ–Ω–Ω–æ—Å—Ç—å", en: "Financial Security" },
        questions: [
          {
            id: "incomeLevel",
            title: { ru: "–£—Ä–æ–≤–µ–Ω—å –¥–æ—Ö–æ–¥–∞", en: "Income Level" },
            descriptions: {
              0: {
                ru: "0 ‚Äì –∂–∏–≤—É –≤ –∫—Ä–µ–¥–∏—Ç–∞—Ö",
                en: "0 ‚Äì living on credit",
              },
              5: {
                ru: "5 ‚Äì —Å—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥, —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–µ",
                en: "5 ‚Äì average, covers main expenses",
              },
              10: {
                ru: "10 ‚Äì –≤—ã—Å–æ–∫–∏–π, –ª—é–±—ã–µ —Ö–æ—Ç–µ–ª–∫–∏",
                en: "10 ‚Äì high and stable, can afford anything",
              },
            },
          },
        ],
      },
      {
        id: "selfImprovement",
        emoji: "üìö",
        title: { ru: "–°–∞–º–æ—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏–µ", en: "Self-Improvement" },
        questions: [
          {
            id: "education",
            title: { ru: "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", en: "Education" },
            descriptions: {
              0: {
                ru: "0 ‚Äì –µ–¥–≤–∞ –∑–∞–∫–æ–Ω—á–∏–ª —à–∫–æ–ª—É",
                en: "0 ‚Äì barely finished school",
              },
              5: {
                ru: "5 ‚Äì —Å—Ä–µ–¥–Ω–µ, –∏–Ω–æ–≥–¥–∞ —É—á—É—Å—å",
                en: "5 ‚Äì average, sometimes study",
              },
              10: {
                ru: "10 ‚Äì –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ–≤—ã—à–∞—é –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é",
                en: "10 ‚Äì constantly improving skills",
              },
            },
          },
        ],
      },
      {
        id: "lifeBrightness",
        emoji: "üéâ",
        title: { ru: "–Ø—Ä–∫–æ—Å—Ç—å –∂–∏–∑–Ω–∏", en: "Life Brightness" },
        questions: [
          {
            id: "travel",
            title: { ru: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è", en: "Travel" },
            descriptions: {
              0: {
                ru: "0 ‚Äì —Å–∏–∂—É –¥–æ–º–∞",
                en: "0 ‚Äì stay at home",
              },
              5: {
                ru: "5 ‚Äì 1-2 –ø–æ–µ–∑–¥–∫–∏ –≤ –≥–æ–¥",
                en: "5 ‚Äì 1-2 trips a year",
              },
              10: {
                ru: "10 ‚Äì –ø—Ä–æ–≤–æ–∂—É 2-3 –º–µ—Å—è—Ü–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π",
                en: "10 ‚Äì spend 2-3 months abroad",
              },
            },
          },
        ],
      },
      {
        id: "spirituality",
        emoji: "üåÄ",
        title: { ru: "–î—É—Ö–æ–≤–Ω–æ—Å—Ç—å", en: "Spirituality" },
        questions: [
          {
            id: "worldview",
            title: { ru: "–ö–∞—Ä—Ç–∏–Ω–∞ –º–∏—Ä–∞", en: "Worldview" },
            descriptions: {
              0: {
                ru: "0 ‚Äì –ø—Ä–æ–∂–∂—ë–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª–∏—Å—Ç",
                en: "0 ‚Äì strict materialist",
              },
              5: {
                ru: "5 ‚Äì —Å—Ä–µ–¥–Ω–∏–π –∏–Ω—Ç–µ—Ä–µ—Å –∫ –Ω–µ–æ–±—ã—á–Ω–æ–º—É",
                en: "5 ‚Äì average interest in unusual",
              },
              10: {
                ru: "10 ‚Äì –≥–ª—É–±–æ–∫–æ –∏–∑—É—á–∞—é –Ω–µ–æ–±—ã—á–Ω—ã–µ —Ñ–∞–∫—Ç—ã",
                en: "10 ‚Äì deeply interested in unusual facts",
              },
            },
          },
        ],
      },
    ];

    // –¢–µ–∫—É—â–∏–π —è–∑—ã–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é RU) –∏ —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–≤–µ—Ç–ª–∞—è)
    let currentLanguage = "ru";
    let darkMode = false;

    // –¢–µ–∫—Å—Ç–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã
    const translations = {
      themeToggleLight: { ru: "–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞", en: "Light Theme" },
      themeToggleDark: { ru: "–¢—ë–º–Ω–∞—è —Ç–µ–º–∞", en: "Dark Theme" },
      langToggle: { ru: "üåê EN", en: "üåê RU" },
      saveResults: { ru: "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (JSON)", en: "üíæ Save Results (JSON)" },
      savePDF: { ru: "üìÑ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (PDF)", en: "üìÑ Save Results (PDF)" },
      balanceWheel: { ru: "–ö–æ–ª–µ—Å–æ –ë–∞–ª–∞–Ω—Å–∞", en: "Balance Wheel" },
      overallAverage: { ru: "–û–±—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ: ", en: "Overall Average: " },
    };

    /****************************************
     * 2. –†–ï–ù–î–ï–† –í–ö–õ–ê–î–û–ö, –ü–û–õ–ó–£–ù–ö–û–í (0..10)
     ****************************************/
    function renderTabs() {
      const tabList = document.getElementById("sphereTabs");
      const tabContent = document.getElementById("sphereTabContent");
      tabList.innerHTML = "";
      tabContent.innerHTML = "";

      spheres.forEach((sphere, index) => {
        // –°–æ–∑–¥–∞—ë–º –≤–∫–ª–∞–¥–∫—É
        const li = document.createElement("li");
        li.className = "nav-item";
        const btn = document.createElement("button");
        btn.className = "nav-link" + (index === 0 ? " active" : "");
        btn.id = "tab-" + sphere.id;
        btn.type = "button";
        btn.setAttribute("data-bs-toggle", "tab");
        btn.setAttribute("data-bs-target", "#pane-" + sphere.id);
        btn.role = "tab";
        // –£–±–∏—Ä–∞–µ–º —Å–ª–æ–≤–æ "–°—Ä–µ–¥–Ω–µ–µ" ‚Äì –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Å—Ç–æ: —ç–º–æ–¥–∑–∏ + –Ω–∞–∑–≤–∞–Ω–∏–µ + (—á–∏—Å–ª–æ)
        btn.innerText = `${sphere.emoji} ${sphere.title[currentLanguage]} (0.0)`;
        li.appendChild(btn);
        tabList.appendChild(li);

        // –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏
        const pane = document.createElement("div");
        pane.className = "tab-pane fade" + (index === 0 ? " show active" : "");
        pane.id = "pane-" + sphere.id;
        pane.role = "tabpanel";

        const header = document.createElement("h5");
        // –¢–æ–∂–µ –±–µ–∑ —Å–ª–æ–≤–∞ "–°—Ä–µ–¥–Ω–µ–µ"
        header.innerText = `${sphere.emoji} ${sphere.title[currentLanguage]} - 0.0`;
        header.className = "mb-3";
        pane.appendChild(header);

        // –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å—ã —Å –ø–æ–ª–∑—É–Ω–∫–∞–º–∏
        sphere.questions.forEach((question) => {
          const formGroup = document.createElement("div");
          formGroup.className = "mb-3";

          const label = document.createElement("label");
          label.className = "form-label sphere-header";
          label.setAttribute("for", `slider_${sphere.id}_${question.id}`);
          label.innerText = question.title[currentLanguage];
          formGroup.appendChild(label);

          const slider = document.createElement("input");
          slider.type = "range";
          slider.className = "form-range";
          slider.id = `slider_${sphere.id}_${question.id}`;
          slider.min = "0";
          slider.max = "10";
          slider.value = "0"; // <-- –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ 0
          slider.addEventListener("input", () => {
            updateSliderDisplay(sphere.id, question.id, slider.value);
            updateSphereAverage(sphere.id);
            drawWheel();
          });
          formGroup.appendChild(slider);

          const desc = document.createElement("div");
          desc.id = `desc_${sphere.id}_${question.id}`;
          desc.className = "form-text";
          // –ù–∞—á–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (value=0)
          desc.innerText = question.descriptions[0][currentLanguage] || "";
          formGroup.appendChild(desc);

          pane.appendChild(formGroup);
        });

        tabContent.appendChild(pane);
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –∫–Ω–æ–ø–∫–∏
      document.getElementById("wheelTitle").innerText =
        translations.balanceWheel[currentLanguage];
      document.getElementById("saveResults").innerText =
        translations.saveResults[currentLanguage];
      document.getElementById("savePDF").innerText =
        translations.savePDF[currentLanguage];

      updateOverallAverage();
    }

    // –ü—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –ø–æ–ª–∑—É–Ω–∫–∞
    function updateSliderDisplay(sphereId, questionId, value) {
      const sphere = spheres.find(s => s.id === sphereId);
      if (!sphere) return;
      const question = sphere.questions.find(q => q.id === questionId);
      if (!question) return;
      const descElem = document.getElementById(`desc_${sphereId}_${questionId}`);
      const dict = question.descriptions[value];
      if (dict) {
        descElem.innerText = dict[currentLanguage];
      } else {
        // –ï—Å–ª–∏ –Ω–µ—Ç —Ç–æ—á–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è value, –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—É—Å—Ç–æ –∏–ª–∏ –æ–∫—Ä—É–≥–ª—è—Ç—å
        descElem.innerText = "";
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ —Å—Ñ–µ—Ä–µ (–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
    function updateSphereAverage(sphereId) {
      const sphere = spheres.find(s => s.id === sphereId);
      if (!sphere) return;
      let sum = 0;
      let count = 0;
      sphere.questions.forEach((question) => {
        const slider = document.getElementById(`slider_${sphere.id}_${question.id}`);
        sum += parseInt(slider.value);
        count++;
      });
      const avg = (sum / count).toFixed(1);

      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤–∫–ª–∞–¥–∫–∏
      const tabButton = document.getElementById("tab-" + sphere.id);
      tabButton.innerText = `${sphere.emoji} ${sphere.title[currentLanguage]} (${avg})`;

      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤–Ω—É—Ç—Ä–∏ –≤–∫–ª–∞–¥–∫–∏
      const paneHeader = document.querySelector(`#pane-${sphere.id} h5`);
      paneHeader.innerText = `${sphere.emoji} ${sphere.title[currentLanguage]} - ${avg}`;

      // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ
      updateOverallAverage();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ —Å—Ä–µ–¥–Ω–µ–≥–æ
    function updateOverallAverage() {
      let total = 0, count = 0;
      spheres.forEach((sphere) => {
        sphere.questions.forEach((question) => {
          const slider = document.getElementById(`slider_${sphere.id}_${question.id}`);
          total += parseInt(slider.value);
          count++;
        });
      });
      const overall = (total / (count || 1)).toFixed(1);
      document.getElementById("overallAverage").innerText =
        `${translations.overallAverage[currentLanguage]}${overall}`;
    }

    /************************************
     * 3. –†–ò–°–û–í–ê–ù–ò–ï –ö–û–õ–ï–°–ê –ö–ê–ö –°–ï–ö–¢–û–†–û–í
     ************************************/
    function drawWheel() {
      const canvas = document.getElementById("balanceWheel");
      const ctx = canvas.getContext("2d");
      const width = canvas.width;
      const height = canvas.height;
      ctx.clearRect(0, 0, width, height);

      const centerX = width / 2;
      const centerY = height / 2;
      // –ß—Ç–æ–±—ã —Å–µ–∫—Ç–æ—Ä –Ω–µ —É–ø–∏—Ä–∞–ª—Å—è –≤ —Å–∞–º—ã–µ –∫—Ä–∞—è, —á—É—Ç—å —É–º–µ–Ω—å—à–∏–º —Ä–∞–¥–∏—É—Å
      const maxRadius = Math.min(width, height) / 2 - 30;

      const numSpheres = spheres.length;
      const anglePerSphere = (2 * Math.PI) / numSpheres;
      let startAngle = -Math.PI / 2; // –Ω–∞—á–∏–Ω–∞–µ–º —Å ¬´–≤–µ—Ä—Ö–∞¬ª –∫—Ä—É–≥–∞

      // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Å—Ñ–µ—Ä–∞–º –∏ —Ä–∏—Å—É–µ–º "–∫—É—Å–æ–∫ –ø–∏—Ä–æ–≥–∞" (—Å–µ–∫—Ç–æ—Ä)
      spheres.forEach((sphere, index) => {
        let sum = 0, cnt = 0;
        sphere.questions.forEach((question) => {
          const slider = document.getElementById(`slider_${sphere.id}_${question.id}`);
          sum += parseInt(slider.value);
          cnt++;
        });
        const avg = sum / (cnt || 1);

        // fraction ‚Äì –æ—Ç 0 –¥–æ 1
        const fraction = avg / 10;
        // –†–∞–¥–∏—É—Å —Å–µ–∫—Ç–æ—Ä–∞
        const sectorRadius = fraction * maxRadius;

        // –£–≥–ª—ã —Å–µ–∫—Ç–æ—Ä–∞
        const endAngle = startAngle + anglePerSphere;

        // –†–∏—Å—É–µ–º ¬´–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π¬ª —Å–µ–∫—Ç–æ—Ä (—Ü–≤–µ—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç sphere)
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, sectorRadius, startAngle, endAngle);
        ctx.closePath();

        // –í—ã–±–∏—Ä–∞–µ–º –ø–∞—Å—Ç–µ–ª—å–Ω—ã–π —Ü–≤–µ—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞ (–ø–æ index)
        const colorIndex = index % pastelColors.length;
        ctx.fillStyle = pastelColors[colorIndex];
        ctx.fill();

        // –ù–∞—Ä–∏—Å—É–µ–º –≤–Ω–µ—à–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É —Å–µ–∫—Ç–æ—Ä–∞
        ctx.strokeStyle = darkMode ? "#ccc" : "#666";
        ctx.stroke();

        // –ü–æ–¥–ø–∏—Å—å —Å—Ñ–µ—Ä—ã —Å –µ—ë —Å—Ä–µ–¥–Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
        // –°—Ç–∞–≤–∏–º –µ—ë –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∫—Ä—É–≥–∞ (—á—Ç–æ–±—ã –Ω–µ –Ω–∞–ª–µ–∑–∞–ª–æ)
        const midAngle = startAngle + anglePerSphere / 2;
        const labelRadius = maxRadius + 20; // —á—É—Ç—å –∑–∞ –∫—Ä–∞–µ–º
        const labelX = centerX + labelRadius * Math.cos(midAngle);
        const labelY = centerY + labelRadius * Math.sin(midAngle);

        ctx.fillStyle = darkMode ? "#fff" : "#000";
        ctx.font = "14px sans-serif";
        // –í—ã–≤–æ–¥–∏–º —ç–º–æ–¥–∑–∏, –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ (avg.toFixed(1))
        // –ú–æ–∂–Ω–æ —á—É—Ç—å —Å–º–µ—â–∞—Ç—å, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –Ω–µ –æ–±—Ä–µ–∑–∞–ª—Å—è
        ctx.fillText(
          `${sphere.emoji} ${sphere.title[currentLanguage]} ${avg.toFixed(1)}`,
          labelX - 30,
          labelY
        );

        // –ü—Ä–æ–≤–æ–¥–∏–º —Ç–æ–Ω–∫—É—é –ª–∏–Ω–∏—é –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ –∫ –≤–Ω–µ—à–Ω–µ–π –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏ (—Ä–∞–∑–¥–µ–ª –º–µ–∂–¥—É —Å–µ–∫—Ç–æ—Ä–∞–º–∏)
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.lineTo(
          centerX + maxRadius * Math.cos(startAngle),
          centerY + maxRadius * Math.sin(startAngle)
        );
        ctx.stroke();

        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–µ–∫—Ç–æ—Ä—É
        startAngle = endAngle;
      });

      // –ü–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ñ–µ—Ä—ã –ø—Ä–æ–≤–µ–¥—ë–º –ª–∏–Ω–∏—é, –∑–∞–º—ã–∫–∞—é—â—É—é –∫—Ä—É–≥
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.lineTo(
        centerX + maxRadius * Math.cos(startAngle),
        centerY + maxRadius * Math.sin(startAngle)
      );
      ctx.stroke();
    }

    /********************************
     * 4. –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–ò –¢–ï–ú–´ –ò –Ø–ó–´–ö–ê
     ********************************/
    const themeBtn = document.getElementById("themeToggle");
    themeBtn.addEventListener("click", () => {
      darkMode = !darkMode;
      document.body.classList.toggle("dark-mode", darkMode);
      themeBtn.innerText = darkMode
        ? `üåô ${translations.themeToggleDark[currentLanguage]}`
        : `üåû ${translations.themeToggleLight[currentLanguage]}`;
      drawWheel();
    });

    const langBtn = document.getElementById("langToggle");
    langBtn.addEventListener("click", () => {
      currentLanguage = currentLanguage === "ru" ? "en" : "ru";
      langBtn.innerText = translations.langToggle[currentLanguage];
      themeBtn.innerText = darkMode
        ? `üåô ${translations.themeToggleDark[currentLanguage]}`
        : `üåû ${translations.themeToggleLight[currentLanguage]}`;
      renderTabs();
      drawWheel();
    });

    /****************************************
     * 5. –°–û–•–†–ê–ù–ï–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –í JSON –ò PDF
     ****************************************/
    document.getElementById("saveResults").addEventListener("click", () => {
      let results = {};
      spheres.forEach((sphere) => {
        let sphereData = {};
        sphere.questions.forEach((question) => {
          const slider = document.getElementById(`slider_${sphere.id}_${question.id}`);
          sphereData[question.id] = parseInt(slider.value);
        });
        results[sphere.id] = sphereData;
      });
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(results, null, 2));
      const downloadAnchor = document.createElement("a");
      downloadAnchor.setAttribute("href", dataStr);
      downloadAnchor.setAttribute("download", "results.json");
      document.body.appendChild(downloadAnchor);
      downloadAnchor.click();
      downloadAnchor.remove();
    });

    document.getElementById("savePDF").addEventListener("click", async () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        unit: "px",
        format: "a4",
      });

      // 1) –°–∫—Ä–∏–Ω—à–æ—Ç canvas (–∫–æ–ª–µ—Å–æ –±–∞–ª–∞–Ω—Å–∞)
      const canvas = document.getElementById("balanceWheel");
      const canvasData = canvas.toDataURL("image/png");

      // 2) –¢–µ–∫—Å—Ç + –∫–∞—Ä—Ç–∏–Ω–∫–∞ –≤ PDF
      let yPos = 20;
      doc.setFontSize(14);
      doc.text(translations.balanceWheel[currentLanguage], 20, yPos);
      yPos += 20;

      // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–ª–µ—Å–∞
      doc.addImage(canvasData, "PNG", 20, yPos, 200, 200);
      yPos += 220;

      // –°–æ–±–∏—Ä–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –ø–æ —Å—Ñ–µ—Ä–∞–º + –æ–±—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ
      let total = 0;
      let count = 0;
      doc.setFontSize(12);
      spheres.forEach((sphere) => {
        let sum = 0, cnt = 0;
        sphere.questions.forEach((question) => {
          const slider = document.getElementById(`slider_${sphere.id}_${question.id}`);
          sum += parseInt(slider.value);
          cnt++;
          total += parseInt(slider.value);
          count++;
        });
        const avg = (sum / (cnt || 1)).toFixed(1);
        doc.text(`${sphere.emoji} ${sphere.title[currentLanguage]}: ${avg}`, 20, yPos);
        yPos += 15;
      });
      const overall = (total / (count || 1)).toFixed(1);
      doc.text(`${translations.overallAverage[currentLanguage]}${overall}`, 20, yPos);

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º PDF
      doc.save("results.pdf");
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener("DOMContentLoaded", () => {
      renderTabs();
      drawWheel();
    });
  </script>
</body>
</html>
